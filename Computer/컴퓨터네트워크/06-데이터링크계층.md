##  데이터 링크



**데이터링크계층**에서 두 호스트가 통신하려면 일대일(1:1)형식의 점대점 방식으로 연결해야 한다. 송신 호스트에서 전송한 프레임은 점대점으로 직접 연결된 수신호스트에 라우팅 과정 없이 전달된다. 기본적으로 데이터 링크 계층 프로토콜은 (a)와 같은 직접 연결 구조에서 둘 사이의 전송오류를 감지하고, 이를 복구하는 기능을 지원한다. (b)의 구조를 지원하려면 호스트 주소 개념이 추가로 필요하다.

![](https://ws1.sinaimg.cn/large/006tNc79ly1fnx67dovl8j30z60miag7.jpg)



물리 계층을 통해 이루어지는 두 호스트 간의 데이터 전송 과정에서 물리적인 전송 오류가 발생할 수 있다. 이 같은 물리적인 오류를 복구하는 것은 데이터 링크 계층의 기본 역할이다. 따라서 데이터 링크 계층은 상위 계층에 신뢰성 있는 데이터 전송을 보장하는데, 오류 제어 방식으로 재전송 기가법을 사용,



### 01 프레임의 종류

- 정보 프레임
  상위 게층이 전송을 요구한 데이터를 수신 호스트에 전송하는 용도로 사용. 약칭하여 **I프레임**
  순서번호, 송수신 호스트 정보 등이 포함됨.
- 긍정 응답 프레임 : **ACK프레임**  
  \- 전송 데이터가 올바르게 도착했음을 회신하는 용도  
  \- 데이터를 수신한 호스트가 데이터를 송신한 호스트에게 전송
- 부정 응답 프레임  
  \- 전송 데이터가 깨져서 도착했음을 회신하는 용도  
  \- 데이터를 수신한 호스트가 데이터를 송신한 호스트에게 전송  
  \- 데이터를 송신한 호스트는 원래의 데이터를 재전송하여 오류 복구  
- 긍정 응답, 부정 응답 프레임 모두 회신하고자 하는 I프레임 순서 번호 포함
  - 제대로 도착한 프레임과 오류가 발생한 프레임 판단 가능

### 02 오류, 흐름 제어가 없는 프로토콜

![](https://ws2.sinaimg.cn/large/006tNc79ly1fnx6ezbhmfj30ju0jagno.jpg)

- 단방향 통신
- 전송 오류가 없는 물리 매체
- 무한 개의 수신 버퍼
- 단순 프로토콜
  - 송신 호스트는 원하는 만큼 자유롭게 프레임을 전송할 수 있음.
  - 오류제어 없음
  - 흐름제어 없음
  - 순서번호도 불필요

### 03 오류제어가 없는 프로토콜

- 단방향 통신
- 전송 오류가 없는 물리 매체
- 전송 오류는 없으나 버퍼 부족으로 프레임 분실 가능
- 정지- 대기 프로토콜 1
  - 수신 버퍼의 개수가 유한
  - 이전 프레임을 잘 받았다는 긍정 응답 기능과 수신 호스트가 송신 호스트의 전송 시점을 지정하기 위한 ACK프레임 필요
  - 데이터의 중복 수신 우려가 있으며 수신번호 기능 필요
  - 정지대기(Stop-and-wait)
    - 하나의 프레임 전송 후 응답 대기
    - 전송 효율이 떨어지므로 잘 사용하지 않음

![](https://ws2.sinaimg.cn/large/006tNc79ly1fnx6irrnnlj30iu0k0ac5.jpg)

### 04 단방향 프로토콜

- 가정을
  1. 단방향 통신 : 송신 호스트에서 수신 호스트 한쪽 방향으로만 데이터 전송
  2. 전송 매체 오류 발생 가능
  3. 버퍼 유한
- 오류제어와 흐름제어가 모두 필요
- 프레임 변형 오류를 해결하기 위한 수신 호스트의 NAK(negative ACK) 기능 필요.
- 프레임 분실 오류를 해결하기 위한 송신 호스트의 타임아웃 기능 필요



### 04.1 NAK가 없는 경우(부정 응답이 없을 경우)

- 정보 프레임 분실
  - 송신 호스트의 타임아웃 기능으로 오류 복구

![](https://ws2.sinaimg.cn/large/006tNc79ly1fnx6snrmdjj30yi0jmtc4.jpg)

- ACK 프레임 분실
  - 송신 호스트의 타임아웃 기능으로 오류 복구

![](https://ws4.sinaimg.cn/large/006tNc79ly1fnx6sv6n0yj30ws0lwjw0.jpg)

- 정보 프레임 변형
  - 송신 호스트의 타임아웃 기능으로 오류 복구

![](https://ws2.sinaimg.cn/large/006tNc79ly1fnx6sz6gtlj30xu0kiq6g.jpg)

### 04.2 NAK가 있는 경우(부정 응답이 있을 경우)

- 정보 프레임 변형 오류
  - 변형된 프레임 무시
    - 프레임 분실 오류와 동일하게 처리

![](https://ws3.sinaimg.cn/large/006tNc79ly1fnx6u9k50nj30x40jsjvh.jpg)

- NAK을 이용하여 통보
  - 더 효율적일 수 있음
  - 다른 요인에 의해 NAk를 사용하지 못하는 경우도 있음

![](https://ws3.sinaimg.cn/large/006tNc79ly1fnx6uhg96oj30wy0i00vg.jpg)



## 슬라이딩 원도우 프로토콜

두 호스트 간의 프레임 전송을 위한 일반적인 통신 프로토콜로,
오류 제어와 흐름 제어 기능을 함께 지원한다. 

슬라이딩 윈도우 프로토콜의 원리는 현재 대부분의 통신 프로토콜에서 사용하는 방식으로, 다음과 같은 절차를 따른다.

1. 정보 프레임을 전송하는 송신 호스트는 보내려는 데이터뿐 아니라 프레임의 순서 번호, 오류 검출 코드 등을 프레임에 표기한 후에 정해진 순서 번호에 따라 순차적으로 송신한다.
2. **정보 프레임을 받은 수신 호스트는 해당 프레임의 순서 번호에 근거하여 송신 호스트에 응답 프레임을 회신해야 한다. 일반적으로 응답 프레임의 내용에 포함되는 순서 번호는 정상적으로 수신한 프레임의 번호를 기재하지 않고, 다음에 수신하기를 기대하는 기대하는 프레임 번호를 표기한다. 따라서 긍정 응답 프레임에 기록된 순서 번호 이전까지의 프레임은 모두 제대로 수신했다는 의미가 된다.**
3. 송신 호스트는 송신한 정보 프레임을 자신의 내부 버퍼에 유지해야 하며, 이를 **송신 윈도우**라 한다. 송신 윈도우에서 대기하는 정보 프레임은 송신 호스트가 수신 호스트에 프레임 전송을 완료했지만 아직 수신 호스트로부터 긍정 응답을 받지 못한 프레임이다.
4. 수신 호스트는 수신한 정보 프레임을 보관하기 위해 내부 버퍼인 **수신 원도우**를 유지할 수 있다. 수신 윈도우에는 개념적으로 수신을 기대하는 프레임의 순서 번호가 들어가기 때문에 프로토콜의 동작 방식에 따라 크기가 달라질 수 있다.  
   선택적 재전송(Selective Retransmission)방식에서는 프레임의 도착이 비순서적으로 이루어져도 처리가 가능하기 때문에 수신 윈도우의 크기가 송신 윈도우의 크기와 동일하다. 그러나 Go-Back N 방식에서는 수신호스트가 항상 이전에 수신한 프레임의 바로 다음 프레임만 기다리기 때문에 수신 원도우의 크기가 1이면 충분하다.  



### 01 흐름제어

슬라이딩 원도우 프로토콜에서 슬라이딩 원도우는 '윈도우의 이동'을 의미하며, 이는 흐름제어 기능을 상징적으로 대변한다. 즉, 수신 호스트가 연속으로 수신할 수 있는 정보 프레임의 개수를 원도우의 크기로 지정함으로써, 송신 호스트의 프레임 전송 속도를 제어한다.

- 순서 번호
  - 프레임 별로 부여되는 일련 번호
  - 0부터 임의의 최댓값까지 순환 방식으로 사용
  - 일반적으로 순서 번호의 최댓값이 송신 윈도우 크기보다 커야함
  - 프레임에서 순서 번호의 공간 크기= n비트 : 순서 번호의 범위는 0 ~ 2^n-1
  - Stop-ans-wait 방식의 경우 n=1인 특별한 경우
- 원도우 크기
  - 긍정 응답 프레임을 받지 않고도 연속으로 전송할 수 있는 프레임의 최대 개수

![](https://ws2.sinaimg.cn/large/006tNc79ly1fnx7hu94utj313q0n4gxs.jpg)

#### 02 연속형 전송

- 정지-대기 프로토콜은 송신 원도우 크기가 1인 경우
  - 프레임 전송 시간이 오래 걸리는 경우 전송 효율이 극단적으로 떨어짐
- 연속형 전송(Pipelining)
  - ACK 프레임을 받지 않고 여러 프레임을 연속으로 전송
  - 전송 오류 발생 가능성이 적은 환경에서는 상당히 요율적
  - 오류 발생이 가능하믈 해결 방안이 필요.
    - Go-back N
    - 선택적 재전송(Selective Repeat)

![- ](https://ws4.sinaimg.cn/large/006tNc79ly1fnx7lxgmmxj315m0r6n53.jpg)

- **오류 복구 과정에서 오류가 발생한 12번 프레임을 포함해 이후에 전송된 모든 정보 프레임을 재전송하는 방식을 고백 방식**
- 고백방식의 문제는 수신 호스트가 올바르게 수신한 정보 프레임도 오류로 처리해 재전송한다는 것이다. 이 문제점을 해결하려면 12번 정보 프레임만 재전송하고 수신 호스트가 제대로 수신한 13~17번 정보 프레임은 정상적으로 처리하여 재전송되지 않도록 해야한다. 이처럼 오류가 발생한 프레임만 선택적으로 복구하는 방식은 **선택적 재전송**이라 한다.

#### 03 피기배킹(Piggybacking)

- 양방향 전송기능을 갖춘 채널 방식에서는 송신 호스트와 수신 호스트의 구분 없이, 양방향으로 동시에 정보 프레임과 응답 프레임을 교차하여 전송할 수 있다. 
- 정보 프레임의 구조를 적당히 조정해 재정의하면 정보 프레임을 전송하면서 응답 기능까지 함께 수행할 수 있다. 이런 방식으로 프로토콜을 작성하면 응답 프레임의 전송 횟수를 줄이는 효과가 있어 전송 효율을 높일 수 있는데, 이를 **피기배킹**이라고 한다.
- 피기배킹 프로토콜을 지원하려면 전송할 데이터와 해당 데이터의 순서 번호는 물론이고, 현재까지 제대로 수신한 프레임의 순서 번호까지 포함된다. 이렇게 함으로써 정보 프레임의 전송과 응답 프레임의 회신을 한 번에 처리할 수 있다.

![](https://ws3.sinaimg.cn/large/006tNc79ly1fnx825j656j30iy0qqn0h.jpg)

## HDLC 프로토콜(High-Level Data Link Control)

컴퓨터가 일대일 혹은 일대다로 연결된 환경에서 데이터의 송수신 기능을 제공한다.  
데이터 통신을 위해 연결된 호스트들은 주국과 종국으로 구분되고, 다시 이들의 기능을 모두 지닌 혼합국으로 정의될 수 있다. 주국에서 전송되는 메시지를 명령이라 정의하며, 이에 대한 종국의 회신을 응답이라 한다.

## LAP(Link Access Protocol)

비동기 응답 모드인 ARM으로 동작하는 프로토콜. 

- 연결설정
  - 주국에서 SARM 명령 전송
  - 종국에서 SARM 응답 전송

![](https://ws4.sinaimg.cn/large/006tNc79ly1fnx8qbxdgmj31480gywie.jpg)

## LAPB(Link Access Protocol-Balanced)

- 양쪽 호스트가 혼합국으로 동작
  - 임의의 호스트에서 SABM전송하여 연결 설정

![](https://ws3.sinaimg.cn/large/006tNc79ly1fnx8uasyogj30ue0le41h.jpg)





