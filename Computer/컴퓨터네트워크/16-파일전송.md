# FTP - 파일 전송



- FTP : FTP 클라이언트와 FTP 서버 사이의 파일 송수신 기능을 제공
- FTP 로그인
  - 원격 시스템에 접속하려면 FTP 서버에 등록된 로그인 계정과 암호가 필요
- 익명 FTP 로그인
  - 다중 사용자를 위한 로그인 계정
    - 계정 : anonymous
    - 암호 : 관례상 자신의 메일 주소



**FTP 명령어?**

\- get : 원격시스템에서 파일을 수신

\- put : 원격시스템으로 파일을 송신

\- ls : 원격시스템의 현재 디렉토리 아래에 존재하는 파일 목록 출력

\- cd : 원격시스템의 현재 작업 중인 디렉토리를 이동

\- lcd : 지역시스템의 현재 작업 중인 디렉토리를 이동

\- bin : 8비트 송수신 기능 지정

\- quit : 프로그램 종료

## FTP 구조

- 2개의 채널 존재  
  \- 제어채널  - FTP프로토콜의 명령과 응답 전송  
  \- 데이터채널 - 복사하려는 파일의 내용 전송  
- 구성 요소
  - 사용자 인터페이스 모듈
  - 명령 송수신 모듈
  - 파일 송수신 모듈
  - Well-known 포트

![](https://ws1.sinaimg.cn/large/006tNc79gy1fohabftazuj30vy0trahg.jpg)

- 요소별 기능
  - 사용자 인터페이스 모듈  
    \- 사용자 명령을 해석하여 명령 송수신 모듈에 전달
  - 명령 송수신 모듈  
    \- 제어 채널 설정(클라이언트가 초기화)  
    \- 사용자 명령을 FTP명령으로 전환하여 제어 채널로 전송
  - 파일 송수신 모듈   
    \- 파일 송수신 요구가 발생할 때마다 데이터 채널 설정(서버가 초기화)  
    \- 데이터 채널을 통하여 파일 복사, 파일 목록 전송 기능 수행
- Well-known 포트
  - 제어 채널: TCP 21번
  - 데이터 채널 : TCP 20번

## 데이터 채널의 설정

![](https://ws1.sinaimg.cn/large/006tNc79gy1fohadrdogoj31cm0taqfz.jpg)

## FTP 명령과 응답

- 제어 채널을 이용하여 FTP명령과 응답을 전송

  ![](https://ws3.sinaimg.cn/large/006tNc79gy1fohae3hbzdj319m0izwi5.jpg)

| 명령                | 설명                                                         |
| ------------------- | ------------------------------------------------------------ |
| USER  <로그인 이름> | 서버에 등록된 로그인 이름  전송.  클라이언트가 서버에 제일  먼저 전송하는 명령. |
| PASS  <암호>        | USER 명령이 성공적으로 수행된  후 사용. 로그인 인증을위한암호전송 |
| QUIT                | FTP 세션의 종료                                              |
| CWD  <디렉토리>     | 서버의 현재 디렉토리 변경                                    |
| CDUP                | 서버의 현재 디렉토리를 상위로  이동                          |
| PWD                 | 서버의 현재 디렉토리 조회                                    |
| MKD  <디렉토리>     | 서버에서 디렉토리 생성                                       |
| RMD  <디렉토리>     | 서버에서 디렉토리 삭제                                       |
| DELE  <파일>        | 서버에서 파일 삭제                                           |
| LIST  <디렉토리>    | 서버의 디렉토리 목록 조회                                    |

| 명령                | 설명                                                 |
| ------------------- | ---------------------------------------------------- |
| TYPE  <유형>        | 전송데이터유형지정 A(ASCII),  E(EBCDIC), I(Image) 등 |
| RNFR  <원래이름>    | 파일이름변경시원래의파일이름                         |
| RNTO  <새로운 이름> | 파일이름변경시새로운파일이름                         |
| RETR  <파일>        | 서버의 현재 디렉토리에서  파일을 복사해 옴           |
| STOR  <파일>        | 클라이언트의 파일을 서버의  현재 디렉토리로 복사     |

 

## FTP 응답

- 3자리 응답 코드와 설명문으로 구성  

  \- **첫번째 숫자가 2인 경우 : 성공 / 첫번째 숫자가 5인 경우 : 실패**

## FTP 로그인 과정

![](https://ws2.sinaimg.cn/large/006tNc79gy1fohagxe7qgj31650xxaez.jpg)

### 텔넷 프로그램을 이용한 FTP 로그인 과정

- FTP서버는 uu.ac.kr 호스트라고 가정
- Telnet.uu.ac.kr 21 명령을 입력
- USER, PASS 명령
- FTP 서버의 현재 디렉토리 이름인 /export/faculty/kihyun 의 메시지를 서버에 회신함
- FTP 세션을 종료하기 위한 QUIT 명령

![](https://ws2.sinaimg.cn/large/006tNc79gy1fohaiug98lj31a70ijq99.jpg)



### FTP 파일 송수신

- FTP 파일 송수신 절차

  - 클라이언트에서 데이터 채널 생성

  - PORT 명령(클라 -> 서버)

    - 생성한 포트 번호 전달

      ​

  - RETR/STOR (파일 송수신 명령) 전달 ( 클라 => 서버)

  | RETR  <파일> | 서버의 현재 디렉토리에서  파일을 복사해 옴       |
  | ------------ | ------------------------------------------------ |
  | STOR  <파일> | 클라이언트의 파일을 서버의  현재 디렉토리로 복사 |

  - 데이터 채널 연결(서버 => 클라)
    - 데이터 전송
    - 데이터 채널 종료
  - 서버에서 응답 코드 전송 (226<메시지>)





## TFTP(Trivial File Transfer Protocol)

- 임의의 시스템이 원격시스템으로부터 부팅(Booting)코드를 다운로드할 때 사용하는 프로토콜
  - 자체적으로 하드디스크를 보유하지 못한 X-terminal과 같은 장치
- 기존 FTP
  - TCP/IP 전체 프로토콜 스택
  - 2개의 채널(제어, 데이터)
  - 디렉토리/파일 관리
- FTP 기능 대폭 축소하여 경량화
  - TCP대신 UDP사용
  - 복잡한 디렉토리, 파일 관리 기능 제거
  - 오직 하나의 파일 복사
- UDP 69 포트

**TFTP 명령**

| 명령  | 설명                                                       |
| ----- | ---------------------------------------------------------- |
| RRQ   | 읽기 요청  인수 : 파일 이름과 모드(ASCII와 이진 파일 구분) |
| WRQ   | 쓰기 요청  인수 : 파일 이름과 모드                         |
| DATA  | 클라이언트나 서버가 데이터  블록 전송                      |
| ACK   | 클라이언트나 서버가 DATA에 대한 긍정 응답 전송             |
| ERROR | 전송과정에서 오류가 발생했을  때                           |

## 세션의 설정과 읽기

- UDP에는 연결 기능이 없으므로, 각 데이터 블록을 독립적으로 전송
- RRQ를 보내면 세션 설정
- DATA를 이용해 데이터를 전송하면 그대로 유지
- 마지막 DATA는 512바이트보다 작은 데이터블록을 보내면 세션 해제
- 파일을 보내는 서버는 DATA, 클라이언트는 ACK만 사용

![](https://ws1.sinaimg.cn/large/006tNc79gy1fohavjft1tj30ug0u30wd.jpg)



## 데이터 쓰기

- WRQ를 보내면 세션설정
- 파일을 보내는 클라이언트는 DATA, 서버는 ACK만 사용



## 데이터 전송

- 데이터 블록 전송을 하나씩 처리하는 흐름 제어 방식
  - 데이터 도착 순서가 바뀔수 없음
- 데이터가 분실되는 경우
  - 송신 측의 타이머 이용
- ACK가 분실되는 경우
  - 송신 측의 타이머 이용
  - ACK를 보낸 후 주어진 시간내에 다음 데이터가 도착해야만 계속 진행
- TFTP는 NAK를 지원하지 않음

![](https://ws3.sinaimg.cn/large/006tNc79gy1fohazayuv5j30y10w6tee.jpg)



