## TCP 프로토콜

1. 전송 계층의 기능
2. TCP 프로토콜
3. TCP프로토콜을 이용한 데이터 전송



전송계층의 프로토콜은 데이터링크 계층과 유사하다.
또한 전송계층에서 연결을 설정하는 방법에는 가상회선방식과 데이터그램 방식이 있다.

왜? 오류 제어, 흐름 제어, 데이터 순서화 등을 제공하기 때문이다.

그러나 다른점은 분명히 있다 무엇?

- 데이터링크 계층은 물리적으로 1:1 연결된 호스트 사이의 전송
- 전송계층은 논리적으로 1:1 연결된 호스트 사이의 전송



왜 오류 제어와 흐름 제어 데이터 순서화는 유사하지만 다르다 왜?

- 계층2와는 달리 다른 버퍼 관리 방법을 필요로 한다. 데이터링크의 경우 라우터와 호스트간이였다면, 전송 계층은 호스트와 호스트간의 범위이기 때문이다.

- 수신자가 송신자의 전송 속도보다 느리게 수신 -> 버퍼 용량 초과로 데이터 분실 -> 타임아웃 기능을 통한 재전송 유발

- 수신자가 슬라이딩 원도우 프로토콜의 원도우 하단 값을 조정

  - 송신자가 보낼 수 있는 패킷의 한계 설정

- **오류 제어**

  - 데이터 변형, 데이터 분실 오류시 재전송 기능으로 복구
  - 수신자 요구(NAK)또는 송신자의 판단(타임 아웃)
  - 선로 오류보다 각 계층의 소프트웨어 동작 과정 중에 분실하는 경로가 대부분
    - 네트워크 계층의 기능적 한계
    - 잘못된 위치/경로 정보

- 분할과 병합

  - 상위계층에서 요구한 데이터 크기가 전송계층에서 처리할 수 있는 크기보다 큰 경우
  - 분할(Segmentation)
  - 병합(Reassembly)

- 서비스 프리미티브

  - 네트워크 계층의 경우 대부분 비연결성 서비스 프리미티브가 정의
  - 전송계층의 경우 비연결형과 신뢰성이 향상된 연결형 서비스 모두 제공**(TCP / UDP)**

- 주소 표현

  - 예 : 네트워크 계층의 호스트 IP주소 + 전송 계층의 포트 번호 조합
  - TSAP(Transport Service Access Point)
  - 구조적 표현
  - 비구조적 표현
  - IP주소
    \- 네트워크와 호스트의 계층적인 특성  
    \- 도메인 주소는 구조적 특징  
    \- 위치 정보와 관련해서는 비구조적 특징  
    ​    주소를 바탕으로 위치를 파악할 수 없음

- 멀티 플렉싱(Multiplexing)

  - 개별적으로 설정된 TPDU의 주소가 동일한 경우 하나의 가상회선에 실어 보내는 것이 유리
  - 종류
    - 상향  
      \- 다수의 전송 계층 연결을 하부의 네트워크 계층에서 하나의 연결로 지원  
      \- 네트워크 계층의 가산회선 연결의 개수를 줄일 수 있음
    - 하향  
      \- 하나의 전송 연결에 대하여 네트워크 계층에서 다수의 가상회선을 지원  
      \- 멀티미디어 전송에 유리, 음성,영상,자막 등을 별도로 가상 회선으로 처리

  ![](https://ws4.sinaimg.cn/large/006tNc79ly1fo0wt1jh97j30ls0eagod.jpg)

- **연결 설정**

  - 개념적으로 양자 합의가 필요하다. **Conn-Req 와 Conn-Ack**
  - 2단계 연결 설정
  - 실제로 프리미티브 전달 과정에서의 분실, 변혈, 복사 가능성이 있으므로 이러한 문제들을 고려해야 함

**3단계 설정(3-Way Handshake)**

#### 연결설정

- 3단계 설정(3-WayHandshake)
  - 세 번째의 Data_Req는 Conn_Ack에 대한 응답기능도 수행
  - 보낼 데이터가 없을 경우 Conn_Ack(y,x)에 대한 응답을 따로 보내야 함

![](https://ws2.sinaimg.cn/large/006tKfTcgy1fo20yplkv6j30ji0hkwg5.jpg)

#### 연결 해제

- 일반적 연결 해제
  - 어느 한쪽의 Disc_req로 전체 연결 해제
  - 상대방이 송신할 데이터가 남아있어도 종료

![](https://ws1.sinaimg.cn/large/006tKfTcgy1fo20z30iy9j30oe0getcd.jpg)

- 점진적 연결 해제
  - 논리적으로 2개의 단방향 연결을 지원
  - 어느 한쪽에서 해제요청을 하는 경우 그 프로세스가 송신하는 연결만 해제
  - 양쪽 모두 Disc_req를 전송해야 해제가 됨

![](https://ws1.sinaimg.cn/large/006tKfTcgy1fo20zjx1luj30oc0hw41j.jpg)

## TCP(Transmission Control Protocol)

IP프로토콜 위에서 연결형 서비스를 지원하는 전송 계층 프로토콜로, 인터넷 환경에서 기본으로 사용한다.

- 연결형 서비스 제공
- 전이중(full-duplex)방식의 양방향 가산회선 제공
- 신뢰성 있는 데이터 전송 보장

일반적으로 전송계층 프로토콜은 운영체제 내부기능으로 구현

TCP에서는 데이터를 세그먼트(Segment)라는 블록 단위로 분할하여 전송

- 블록크기는 네트워크 부하 정도, 원도우 크기 등에 영향
- 가변 크기
- 세그먼트당 순서번호를 부여하지 않고, 세그먼트에 실어보내는 데이터 바이트 수를 순서번호에 반영

**상위 계층에서는 연결형 서비스와 비연결형 서비스를 선택하여 전송 프로토콜(TCP, UDP)선택**

\- 데이터 링크 계층에는 다양한 네트워크 인터페이스 존재

![](https://ws1.sinaimg.cn/large/006tKfTcgy1fo218451c5j30w40g8wjz.jpg)

![](https://ws4.sinaimg.cn/large/006tKfTcgy1fo21a39orhj30zc0pmqb1.jpg)

- 헤더 - 최소 20바이트 최대 40바이트

  ​

![](https://ws2.sinaimg.cn/large/006tKfTcgy1fo21f7gn4yj313s0pwtf2.jpg)



![](https://ws3.sinaimg.cn/large/006tKfTcgy1fo21f1grfpj313o0ny45s.jpg)



![](https://ws2.sinaimg.cn/large/006tKfTcgy1fo21euwtovj314a0t60z6.jpg)

---



### TCP의 연결 설정

- 3단계 설정(3-way handshake)
  - A프로세스의 연결설정 요청
    - 임의의 순서번호(10) 선택한 후 SYN(연결설정요청)전송
  - B 프로세스의 응답
    - 10에 대한 응답(ACK)과 임의로 선택한 순서번호(50)의 SYN 전송
  - A프로세스가 현재 보낼 데이터가 없는 경우
    - 50에 대한 응답(ACK) 전송

![](https://ws4.sinaimg.cn/large/006tKfTcgy1fo21p99jh8j30iy0ncdi1.jpg)

- 정상적인 데이터 전송
  - 3번째 연결설정단계에서부터 데이터 전송가능
  - 데이터 크기만큼 순서번호 증가
  - 흐름제어는 원도우 필드 이용

![](https://ws3.sinaimg.cn/large/006tKfTcgy1fo21ve8bwaj30ji0o8jty.jpg)

- 데이터 전송 오류
  - 동일한 순서번호 - 중복으로 판단하고 폐기
  - 순서번호가 빠지는 경우 - 분실로 판단
  - NAK는 지원하지 않음 - 분실 또는 변형시 수신프로세스는 응답을 하지 않고, 송신측에서 타임아웃기능으로 재전송

# ![](https://ws3.sinaimg.cn/large/006tKfTcgy1fo21xhkvbfj30mo0oaae8.jpg)

### TCP의 연결 해제

- 해제하고자 하는측에서 FIN 전송
- FIN수신측에서 보낼 데이터가 있는 경우 계속 송신할 수 있다.

![](https://ws2.sinaimg.cn/large/006tKfTcgy1fo21zvav8wj30ns0omae4.jpg)

### 혼잡제어

- ECN(Explicit Congestion Notification) 기능 : TCP의 혼잡 제어 기능을 지원
  - ECN기능을 사용 : (a) 처럼 SYN, ACK, ECE플레그를 지정하여 응답
  - ECN기능을 사용 안함 : (b)처럼 SYN, ACK 플래그만 지정하여 응답

![](https://ws2.sinaimg.cn/large/006tKfTcgy1fo22032nbdj30xg0fi779.jpg)

- 수신 프로세스의 중개(Echo)를 거쳐 간접적으로 송신프로세스에 혼잡을 통지
  - 혼잡을 인지한 라우터 다음의 라우터들이 ECN 기능을 반복적으로 수행하지 못하도록 함

![](https://ws4.sinaimg.cn/large/006tKfTcgy1fo22199rhjj31300j4q79.jpg)