## 네트워크 계층 프로토콜

### IPv6?

IPv4의 주소공간 부족으로 IPv6가 나왔다. 이로인해 여러 장점이 생겨났는데,

1. 주소공간의 확장 - 32비트(4바이트)에서 128비트(16바이트)로 확장되었다. 그러므로 최대 2^128개의 호스트를 지원한다.
2. 헤더 구조가 단순화되었다  
   \-  불피룡한 필드 제외  
   \- 옵션은 모두 확장헤더 방식으로 지원  
   \- 오류제어등의 오버헤드를 줄여 프로토콜의 전송 효율 향상
3. 흐름 제어 기능 지원  
   \- Flow Label 도입으로 일정 범위 내에서 예측 가능한 데이터 흐름을 지원  
   \- 하나의 연속 스트림(stream)으로 전송해야 하는 연관 패킷 전송기능지원  
   \- 실시간 멀티미디어 응용 환경을 수용

총 9개의 기본 필드를 지원한다.
![](https://ws1.sinaimg.cn/large/006tNc79ly1fo0sbow8hwj311k0m40zf.jpg)

![](https://ws4.sinaimg.cn/large/006tNc79ly1fo0sbugkgbj311g0q0gsl.jpg)



그리고 IPv6는 기본적으로 유니캐스팅과, 멀티캐스팅을 모두 지원하지만 애니캐스팅이라는 특정범위에만 패킷을 전송할 수 있는 지원한다. 애니캐스팅 방식은 멀티캐스팅과 유사한 기능을 제공하며, 멀티캐스팅 방식이 그룹 내의 모든 호스트에 패킷을 전송하는 반면, 애니캐스팅 방식은 그룹내의 특정 호스트에만 패킷을 전송한다.

## Mobile IP(이동 IP)

 기존의 유선망 환경을 위주로 한 고정 통신망에서 유무선이 복합된 이동 광대역 통신망 시대가 본격적으로 진행되고 있다. 점점 더 유무선 통합 서비스가 확대되며, 고속의 멀티미디어 서비스 지원이 가속화 될 것이다.

Mobile IP의 터널링 원리를 이해하자.

핸드오버(Hand-over) : 끊이지 않고 계속 통화가 되는것.
로밍(Roaming)

![](https://ws1.sinaimg.cn/large/006tNc79ly1fo0sl69iarj314c0r8tm8.jpg)

**버스에 탄채로 배에 실어서 이동한다.**



IP터널링을 설명하기 위해서는 주소를 표현해야 한다.

- 통신할 상대방을 구분하기 위해 주소(Address)필요
- 이동망 환경에서 주소 처리
  - 이동한 위치에서 새로운 IP주소 할당
  - 호스트 고유의 주소 유지
- 기존 IP주소가 가진 두 가지 기능
  - 호스트 식별
  - 경로(위치)

Mobile IP??????????

에이전트(Agent)

- 두 종류의 주소 사용
  - Home Address
    - 이동 호스트를 위한 고정 주소
    - HA(Home Agent) - 이동 호스트를 위한 고정 위치에서 FA로의 연결 처리
  - COA(Care of Address)
    - 이동 호스트를 위한 가변주소(일시적 할당)
    - FA(Foreign Agent) - 이동 호스트에서 근접한 FA / COA 관리 및 HA와의 터널 관리
- 호스트가 이동할 때의 처리
  - HA는 변하지 않고 FA만 변함
  - 따라서 HA와 새로운 FA사이에 터널 설정

![](https://ws2.sinaimg.cn/large/006tNc79ly1fo0t6rvwcbj30mq0aytbk.jpg)



 이동 호스트에서 고유 IP주소인 홈 주소(Home Address)HA가 할당되고, 이 주소는 호스트 위치가 바뀌어도 변하지 않는다. 이동 호스트가 네트워크에 있는 다른 호스트와 통신할 때 홈 주소를 사용한다. COA는 이동 호스트가 위치를 변경할 때 새로 이동한 지역에서 일시적으로 할당된 IP주소이다. 따라서 호스트가 이동할 때마다 새로운 COA가 할당되고 기존 COA는 회수되는 과정이 반복된다. 홈 에이전트와 이동 에이전트 사이에 설정되는 터널은 원 IP패킷을 목적지까지 전송하기 위한 중간 단계의 새로운 경로이다. 따라서 송신 호스트와 수신 호스트 사이에서 동작하는 IP프로토콜과는 별도로 추가적인 IP프로토콜을 사용해 패킷을 중개해야 한다.



## IP터널(Mobile IP)

- 터널 구간에서 IP캡슐링 방식으로 패킷을 중개  
  \- 원 패킷 : 송신 호스트가 전송하고, 수신 호스트가 수신 받는 패킷  
  \- IP 캡슐 패킷 : 터널 구간에서 원 패킷을 IP캡슐화
- 추가된 헤더의 목적지에 COA가 들어감.

![](https://ws1.sinaimg.cn/large/006tNc79ly1fo0t9pqfb2j30lw0gydin.jpg)



## 기타 프로토콜



### ARP

- Address Resolution Protocol

- 필요성

  \- 실제로 통신이 이루어지기 위해선 데이터링크 계층의 MAC 주소를 알아야 가능  
  \- 송신 MAC 주소 - LAN 카드에서 획득  
  \- 수신 MAC 주소 - ARP request 발송, 해당 호스트가 자신의 MAC주소를 ARP reply로 회신 

- 과도한 트래픽 유발을 방지하기 위해 캐시 이용

![](https://ws2.sinaimg.cn/large/006tNc79ly1fo0thj20vij30om0gen1v.jpg)

### RARP

- Reverse Address Resolution Protocol
- 필요성
  - 하드디스크가 없는 시스템은 자신의 IP주소를 저장할 수 없음
    - ROM에 TFTP등 기본 프로토콜만 존재
    - 서버에서 관련 정보를 받아 메모리에 저장
  - 이 경우 자신의 HW주소를 방송하여 RARP서버가 알려준 IP주소 이용
- 동작
  - 자신의 MAC주소를 담아 방송
  - 해당 정보를 가지고 있는 RARP서버가 응답

### ICMP(Internet Control Message Protocol)

- ICMP 메시지
- 오류에 관한 처리를 지원하며, IP프로토콜은 데이터 전송 과정에서 패킷 폐기 등의 오류가 발생해도 이를 보고하는 기능이 없다. 따라서 이를 대체 지원하기 위해 네트워크 계층 프로토콜인 ICMP는 오류가 발생한 IP패킷에 대하여 그원인을 송신 호스트에 전달한다. TCP/IP 기반의 통신망에서 전송 과정에 문제가 발생하면 라우터에 의해 ICMP 메시지가 자동으로 발생한다. 

### IGMP(Internet Group Message Protocol)

- 멀티캐스팅(Multicasting)
  - 특정 기룹에 속한 모든 호스트에게 메시지를 전송하는 방식
- 그룹 관리
  - 그룹의 생성/제거, 그룹 참가/탈퇴
  - 멀티캐스팅을 지원하기 위한 방안
    - 다중 호스트를 표시하는 멀티캐스트 그룹 주소 표기 방법의 토일
    - 라우터가 멀티캐스트 주소와 이 그룹에 속하는 호스트 사이의 연관성 처리
    - 효율적인 멀티 캐스트 라우팅 알고리즘
- IGMP 메시지의 전송
  - IGMP는 IP프로토콜과 동등한 계층의 기능을 수행
  - IP패킷에 캡슐화되어 전송