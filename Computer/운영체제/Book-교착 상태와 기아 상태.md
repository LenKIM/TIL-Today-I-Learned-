## 교착 상태와 기아 상태



교착 상태란 무슨 의미?  
다중 프로그래밍 시스템에서는 프로세스가 결코 일어나지 않을 사건을 기다리는 상태가 되면 교착상태(deadlock)에 빠졌다고 한다.   
교착 상태는 제한된 자원의 사용률을 높이고 시스템 효율성을 증가시키려고 사용하는 병행처리 기술과 자원 공유에 따른 부작용이다. 

### 교착상태가 발생하는 예시

- 스풀링 시스템에서 발생하는 교착 상태
- 디스크를 공유할 때 발생하는 교착 상태
- 네트워크에서 발생하는 교착 상태

![](https://ws1.sinaimg.cn/large/006tKfTcgy1fn102mes7cj30zo11edkw.jpg)

**① 상호배제(Mutual Exclusion) : 한 번에 한 프로세스만 해당 자원을 사용할 수 있어야 합니다.**

**ex) 그림 1에서 자원 R1은 P1 or P2 프로세스 중 하나의 프로세스에서만 사용해야 합니다.**


**② 점유와 대기(Hold and Wait) : 프로세스가 한 개 이상의 자원을 할당받은 후 다른 프로세스에 **

할당된 자원을 기다리는 상태 입니다.

**ex) 그림 1에서 P1 프로세스는 자원 R2를 할당받은 후 P2 프로세스에 할당된 자원을 얻기 위해 기다리는 중 입니다.**


**③ 비선점(No Preemption) : 다른 프로세스가 사용중인 자원을 강제로 뺏을 수 없습니다. **

**즉, 사용중인 자원을 다른 프로세스에게 양보하지 않는 것 입니다.**

**ex) 그림 1에서 P1 프로세스가 P2 프로세스가 사용중인 자원 R1을 강제로 뺏을 수 없습니다.**


**④ 순환대기(Circular Wait) : 프로세스들이 순환(원형)을 이루어서 존재, 이를 구성하는 각 프로세스는 **

**이전 프로세스가 요청하는 자원을 점유하고 다음 프로세스가 점유하고 있는 자원을 요청하는 경우 입니다.**

**순환대기는 점유대기, 비선점, 상호배제 조건을 만족해야 발생할 수 있는 현상입니다.**

**ex) 그림 1에서 P1 프로세스는 P2 프로세스가 요청한 자원 R2를 점유하고**

**다음 프로세스인 P2가 점유하고 있는 자원 R1을 요청하고 있습니다. P2 프로세스도 마찬가지 입니다.**



### 교착 상태의 발생 조건(4가지)

- 상호배제 : 프로세스들이 필요로 하는 자원에 대해 배타적인 통제권을 요구한다.
- 점유와 대기 : 프로세스가 할당된 자원을 가진 상태에서 다른 자원을 기다린다.
- 비선점 : 프로세스가 어떤 자원의 사용을 끝낼 때까지 그 자원을 뺏을 수 없다.
- 순환(환형)대기 : 각 프로세스는 순환적으로 다음 프로세스가 요구하는 자원을 가지고 있다.



### 교착 상태 예방

- 상호배제 조건의 제거 : 교착 상태는 두 개 이상의 프로세스가 공유가능한 자원을 사용할 때 발생하는 것으므로 굥유 불가능한, 즉 상호 배제조건을 제거하면 교착 상태를 해결할 수 있다.
- 점유와 대기 조건의 제거 : 한 프로세스가 수행되기 전에 모든 자원을 할당시키고 나서 점유하지 않을 떄에는 다른 프로세스가 자원을 요구하도록 하는 방법이다. 자원 과다 사용으로 인한 효율성, 프로세스가 요구하는 자원을 파악하는 데에 대한 비용, 자원에 대한 내용을 저장 및 복원하기 위한 비용, 기아 상태, 무한대기 등의 문제점이 있다.
- 비선점 조건의 대기 : 비선점 프로세스에 대한 선점 가능항 프로토콜을 만들어 준다.
- 환영 대기 조건의 제거 : 자원 유형에 따라 순서를 매긴다.



### 교착 상태 회피

자원이 어떻게 요청될지에 대한 추가정보를 제공하도록 요구하는 것으로 시스템에 circular wait가 발생하지 않도록 자원 할당 상태를 검사한다.

- 프로세스의 시작 중단
- 자원 할당 거부  
  \- 프로세스가 요청한 자원을 할당했을 때 교착 상태가 발생할 수 있다면 요청한 자원을 할당하지 않는다. 이를 보통 은행가 알고리즘이라고 부른다.

*은행가 알고리즘이란?*

자원의 할당 허용 여부를 결정하기 전에 미리 결정된 모든 자원의 최대 가능항 할당량을시뮬레이션하여 안전 여부를 검사, 그런 다음 대기 중인 다른 모든 활동의 교착 상태가 가능성을 조사하여 '안전 상태'여부를 검사-확인한다. 

**즉, 프로세스가 자원을 요구할 때 시스템이 자원을 할당 후 안정 상태로 남아있게 되는지를 사전에 검사하여 교착상태를 회피하는 방법이다.**

![](https://ws1.sinaimg.cn/large/006tKfTcgy1fn106aptxpj30vo0z2gpy.jpg)

 여러 유형의 자원을 가진 시스템에서 사용되며, 시스템이 자원을 할당한 후에도 안정 상태로 남아있는지 검사하여 안정 상태에 있으면 자원을 할당하고 그렇지 않다면 다른 프로세스들이 자원을 해제할 때까지 대기합니다.

**START**단계에서는 자원 상황과 자원 종류의 최대수를 파악합니다. **자원 할당 요청** 단계에서는 프로세스의 자원 할당 요구를 요청받습니다. 그리고 **안정한가?**에서는 **안정 알고리즘을 사용하여 시스템 상태를 점검한 후 자원할당 여부를 결정하게 됩니다.**



**그러나 여기서도 단점이 존재하는데,**  

1. **할당할 수 있는 자원의 수가 일정해야 합니다.**
2. **사용자 수가 일정해야 합니다.**
3. **항상 불안정 상태를 방지해야 하므로 자원 이용도가 낮습니다.**



![](https://ws1.sinaimg.cn/large/006tKfTcgy1fn10ifbuesj316u0vun2c.jpg)

### 기아 상태

![](https://ws2.sinaimg.cn/large/006tKfTcgy1fn10ix0qemj30yc12qdp7.jpg)

식사하는 철학자 문제는 다수의 프로세스가 다수의 자원을 할당할 때 상황을 나타낸 것으로 철학자를 프로세스에 젓가락(포크)을 자원에 비교하여 설명하는 문제.

**배경**  
철학자 5명은 대부분의 시간을 생각하고 먹는데 소비한다. 철학자는 의자 5개로 둘러싼 원형테이블을 공유한다. 테이블 중앙에는 음식이 있고, 테이블 둘레에는 포크가 5개 놓여 있다. 지역 풍습에 따라 철학자들은 포크 2개로 식사한다. 그런데 포크가 5개라서 철학자 5명이 동시에 식사할 수 없고, 2명만이 동시에 식사할 수 있다.

**문제**

만약 모든 철학자들이 모두 원쪽 젓가락(포크)을 집고 오른쪽 젖가락을 집으려 한다면 교착상태에 빠지게 될어 모두 굶게 됩니다. 교착 상태에 빠지지 않기 위해 철학자 4명만 테이블에 동시에 앉게 하는 방법, 양쪽 젓가락 모두 사용가능 할 때, 젓가락을 집을 수 있도록 허용 하는 방법으로 교착 상태를 방지할 수 있지만, 기아상태를 해결해주지는 못합니다.

철학자 4명이 동시에 식사를 하는 방법을 선택했는데 나머지 한 명의 철학자에게 젓가락을 사용할 기회가 오지 않아서 굶주리는 상황을 기아상태라고 한다.

**즉 기아상태란 프로세스가 필요한 자원들을 영원히 할당받지 못해서 계속 기다리고 있는 상태를 말합니다.**

**해결**

간단한 해결책은 각 포크를 세마포로 표시하는 것이다. 철학자는 포크에 해당하는 세마포에 대한 P(wait)연산을 수행하고 나서 포크를 집는다. 즉 포크는 해당 세마포에 대한 V(signal)연산을 수행하여 내려 놓는다.