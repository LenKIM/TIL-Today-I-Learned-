NOSQL 등장배경

기존 컴퓨팅 시스템 특징
 - 기업 업무가 자동화하고 효율화하는 목적

NoSQL = Not Only SQL

##### 특징
 - NoSQL은 분산형 구조를 띠고 있기 떄문에 분산 시스템의 특징을 그래도 반영하여 대부분 CAP이론을 따름
 - CAP이론이란, 분산 컴퓨팅 환경은 Consistency(일관성), Availability(가용성), Partitioning(부분결함 용인)  
 3가지 특징을 가지고 있으며, 이중 2가지만 만족할 수 있다는 이론


##### 종류
- Key/Value Store
  - 대부분의 NoSQL은 Key/Value 개념을 지원
  - Unique Key에 하나의 Value를 가지고 있는 형태
  - put(key, value), value := get(key) 형태 API사용

- Ordered Key/Value Store
  - 데이터가 내부적으로 Key를 순서로 Sorting되어 저장됨
  - Key아네(column:value)조합으로 된 여러개의 필드를 가지는 구조
  - 대표 제품 : Hbase, Cassandra

- Document Key/Value Store
  - Key/Value Store의 확장된 형태
  - 저장되는 Value의 데이터 타입으로 "Document"라는 구조화된 데이터 타입(JSON, XML, YAML등)을 사용
  - 복잡한 계층구조 표현 가능
  - 제품에 따라 추가 기능(Sorting,Join,grouping)지원

- NoSQL System List
   - Key Value Store : Redis
   - BigTable-style Databases : HBase, Apache Cassandra
   - Document Object : MongoDB
   - Full Text Search Engines : Apache Lucene,
   - Graph Databases: neo4j, FlockDB


##### NoSQL 장점/단점
  **Relational modeling**
  - 전형적으로 가용한 데이터 구조를 기반
  - "내가 가지고 있는 답이 무엇인가?(What answers do I have?)"
  - 데이터 모델 정의 후, 어플리케이션에 맞는 쿼리 개발
  - RDBMS 모델링 기법
    1. 저장하고자 하는 도메인 모델 분석
    2. 개체 간의 관계 식별
    3. 테이블 추출
    4. 테이블을 이용한 쿼리 구현

  **NoSQL data modeling**
  - 어플리케이션 특징적인 데이터 접근 패턴에 따라 모델링
  - "내가 가지고 있는 질문은 무엇인가?(What questions do I have)"
  - 어플리케이션의 필요한 쿼리와 성능을 정의한 이후, 요구 사항에 부합하도록 데이터 모델을 구성
  - NoSQL 데이터 모델링 기법
    1. 도메인 모델 분석
    2. 쿼리 결과 도출
    3. 테이블(데이터 저장 모델)설계

  **NoSQL 모델링 특징**
  - 관계형 데이터베이스 모델링 보다 더 깊은 데이터 구조 및 접근 알고리즘에 대한 이해가 필요함
  - NoSQL쿼리가 실제 몃개의 물리 노드에 걸쳐서 수행되는지에 대한 이해가 있어야 제대로된 쿼리 디자인이 가능함
  - NoSQL 디자인은 DB와 어플리케이션 뿐만 아니라 인프라(네트웤,디스크)에 대한 디자인을 함께 해야함
  - 대부분의 NoSQL DB는 인증이나 인가 체계가 없어서 보안에 매우 취약하기 때문에 별도의 보안 체계를 마련해야 함(방어벽이나 Reverse Proxy등)

  **RDBMS 장점**
  - 범용적이고 고성능
  - 대부분의 경우에 관계형 데이터베이스를 사용하는 것이 안정적
  - 데이터의 일관성을 보증할수 있다(트랜잭션)
  - 한번에 이뤄져야 하는 작업의 경우 데이터불일치 상황을 방지
  - 정규화를 전제로 하고 있기 때문에 업데이트시 비용이 적다(동일 컬럼은 동일 장소에 존재)
  - 데이터베이스 설계시 이미 불필요한 중복이 삭제됨
  - 복잡한 형태의 쿼리도 가능(Join)
  - 이미 성숙한 기술

  **RDBMS 단점**
  - 대량의 데이터 입력처러
  - 테이블의 인덱스 생성이나 스키마 변경시
  - 개발/운영시 컬럼을 확정 짓기 어려운 경우

  **NOSQL 장점**
  - NoSQL은 특정용도로 특화되어있음
  - 그래서 각 NoSQL의 솔루션의 특징을 알 필요가 있음
  - 데이터 분산에 용이
  - 기본적으로 NoSQL의 join연산은 대부분 불가능함
  - 즉 데이터모델 자체가 독립적으로 설계되어 있고 데이터를 여러서버에 분산시키는 것이 용이함
  - 데이터에 대한 캐시가 필요한 경우
  - 배열 형식의 데이터를 고속으로 처리할 필요가 있는 경우
  - 어쨌든 모든 데이터를 저장하고 싶은 경우.

  **NOSQL 단점**
  - 각 솔루션의 특징을 이해할 필요가 있음
  - 아직 새로운 기술로 운영 노하우가 적음
  - 버그가 상대적으로 많이 있는 상태
  - 업체마다 고유의 특색을 살린 NosQL을 개발해 공개하는 경우가 많아 새로운 솔루션이 계속 출시되는 상태

### NOSQL의 데이터모델링 개념
  **Denormalization**
  - "비정규화" = 데이터 중복 허용
    - 쿼리 프로세싱을 간단하게 하거나 최적하게 하기 위해서는 또는 사용자의 데이터를 특정한 데이터 모델에 맞추기 위해서 같은 데이터를 여러 도큐먼트나 데이블에 복제하여 중복하는 것을 허용함
  - 비정규화로 인한 트레이트-오프
    - Query data volume or IO per query VS total data volume

  **Aggregates**
  - "dㅠ연한 스키마" 속성은 복잡하고 다양한 구조의 내부 요소를 가지고 있는 데이터 클래스를 구성 가능케함
      - 1:n 관계를 최소하여 결과적으로 JOIN연산을 줄임
      - 복잡하고 다양한 비지니스 요소를 담을 수 있음

  => 대부분의 NOSQL솔류션은 기본적으로 "유연한 스키마"를 제공함.

  - NoSQL의 Scheme-less 특성을 이용하면, 데이터 모델을 하나의 테이블로 합칠 수 있음

  **Application Side Joins**
  - 대용량 데이터에 대해 빠른 응답 성능과 확장성, 가용성을 최우선 무적으로 하기 때문에, 쿼리 타임 조인을 최대한 피하여 데이터모델을 구성하는 것을 가정함
  - JOIN대상 데이터에 대해 비정규화, 어그리게이션을 수행할 떄 문제가 발생하는 경우
    - JOIN대상 데이터가 다대다관계를 가짐
  - NOSQL안에서 조인이 안되기 떄문에, 어플리케이션 안에서 조인을 시도하자.

##### 진짜 모델링 기법!
  **Composite Key**
  - 하나 이상의 필드를 deliminator를 이용하여 구분 지어 사용하는 방법
  - Ordered KV Store의 경우에는 이를 이용하여 order by와 같은 sorting기능이나 grouping을 구현가능
  - NoSQL N개의 서버로 구성된 클래스로 동작하고 데이터는 Key를 기준으로 N개의 서버에 나눠서 저장이 됨
  - Key를 선정할 떄는 전체 서버에 걸쳐서 부하가 골고루 분산될 수 있는 Key를 선정해야 함!
  - 원도우의 하위폴더,

  **Inverted Search Index**
  - value의 내용을 Key로 하고, Key내용을 반대로 value로 하는 패턴
  - 검색엔진에서 많이 사용하는 방법
  - 용도애 따라 변환을해서 재 모델링하는 기법
  - 키 / 벨류가 벨류/키로 변경할 수도 있음.

  **계층 데이터 구조 모델링 패턴**
  - NoSQL은 다양한 데이터 모델이 있지만, 기본적으로 row, column을 가지고 있는 테이블 구조의 저장 구조를 갖음
  - 어플리케이셔 개발중에는 이런 테이블 구조뿐만 아니라 Tree와 같은 게층형 데이터 구조를 저장해야 할 경우가 있는데, NoSQL은 이러한 게층형 구조를 저장하는 것이 쉽지 않음.
  - RDBMS의 경우에도 이런 계층형구조를 저장하기 위해서 많은 고민을 해왔기 때문에, 솔루션에서 기능적으로 자체지원하기도하고 데이터 모델링을 통해서 계층형 구조를 저장할수 있음
  - NoSQL에서 계층형 구조를 저장하는 기법은 RDBMS에서 사용하는 기법들을 참고하여 구현함

  **1.Tree Aggregation**
  - Firebase에서 채팅앱을 만들기 위해 데이터베이스를 건들이는데, 이와 같은 구조임.

  **2. Materialized Path**
  - Tree 구조를 테이블에 저장할때, root에서 부터 현재 노드까지의 전체 경로를 key로 저장하는 방법
  - 구현에 드는 노력에 비해서 매우 효율적인 저장 방식
  - Key에 대한 Search를 할 때 Regular Expression을 사용할 수 있으며, 특정 노드의 하위 트리등을 쿼리해 오는 기능등 다양한 쿼리가 가능

### 3.NoSQL 데이터 모델링 예시**
1. 도메인 모델 파악
2. 쿼리 결과(데이터 출력 형태) 디자인
 - 도메인 모델 기반으로 어플리케이션에서 쿼리가 수행되는 결과값을 먼저 정함
 - 출력형식을 기반으로 필요한 쿼리 정의
 - 출력 데이터를 기반으로 테이블 추출

3. 패턴을 이용한 데이터 모델링(위에서 배웠던 모델링기법중하나)

4. 기능 최적화하는 방법을 고려한다!

5. NoSQL선정 및 테스트
- 모델링한 데이터 구조를 효과적으로 실행할 수 있는 NoSQL검토
- NoSQL 특성 분석 및 부하 테스트, 안정성/확장성 테스트 수행
- 경우에 따라서는 여러 개의 NoSQl을 복합하여 사용

=> 하나의 NoSQL만으로 모든 데이터를 처리하려고 하지말고, RDBMS와 혼용하거나 다른 NoSQL과 연동하여 최적의 시스템을 설계

6. 선정된 NoSQL에 최적화 및 하드웨어 디자인
- 선정된 NoSQL에 적합하게 데이터 모델을 최적화
- 해당 NoSQL에 맞는 어플리케이션 인터페이스 설계
- 구동시킬 하드웨어 디자인

=> 반드시 데이터 모델과 내부 아키텍처를 제대로 파악하고, 그에 맞는 NoSQL을 선정

7. 결론
- NoSQL시스템 개발시, 데이터 모델링이 80%이상을 차지함
- 선정한 NoSQL과 어플리케이션 특성에 맞는 데이터 모델링에 집중
