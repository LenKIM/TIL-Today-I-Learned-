학습목표
1. MongoDB의 백업과 복구 종류에 대해 알 수 있습니다.
2. MongoDB데이터베이스 백업/복구 방법에 대해 알 수 있습니다.

-----
1. MongoDB의 백업과 복구 종류에 대해 알 수 있습니다.
- 데이터베이스 솔루션을 사용하는 이유 : 데이터의 안전한 저장과 값에 대한 일관성을 보장받기 위함
- 하나의 서비스를 진행하다보면 각종 진행 상황에 접하게됨
- 장애 발생시 가장 중요하게 필요한 것이 백업과 복구에 관련된 기능임
- 기존에 관계형 데이터베이스 솔루션의 경우에는 테이블별로 사용하는 솔루션에 따라 단순히 데이터가 저장된 파일을 복사하는 것만으로도 가능한 경우가 있음
- NoSQL의 솔루션은 한 대 이상의 서버에 데이터가 복제되거나 분산되어 저장될 수도 있기 때문에 단순히 파일을 복사하는 것만으로는 데이터 복제와 복구가 쉽지 않을수 있음
- MongoDB가 기존에 mySQL등과 같은 관계형 데이터베이스와 차이점이 있기는 하지만, 백업과 복구에 관해서는 유사함
- MongoDB는 기본적으로 데이터를 덤프로 뜨고 복구하거나 리플리케이션하는 등의 다양한 백업/복구 기능을 지원

 **ShutDown&Filecopy**
 - 가장 기초적인 백업 방법
 - MongoDB는 기본적으로 noSQL솔루션이지만 결국 저장된 데이터는 운영체제의 특정폴터 또는 지정된 폴더에 해당 데이터를 차곡차곡 저장하게 됨

**FSyncLock&backup**
 - File Copy는 데이터 베이스를 종료하고 실행하는 것
 - File Copy에서 데이터베이스를 종료하는 이유는 데이터 복제 중에 새로운 데이터가 유입되거나 기존 데이터가 변경/삭제 될 경우 무결성에 문제가 생길 수도 있기 때문
 - 그러한 문제를 원천적으로 차단하기 위해 아예 데이터베이스 인스턴스를 종료하고 물리적으로 격리된 상태에서 파일복사를 진행하는 것

 그러나
 - FSyncLock을 통해 데이터베이스 전체에 락을 걸고 데이터를 복제하는 방법
 - FSyncLock을 사용하게 되면 데이터베이스 전체에 Lock을 걸 수가 있어서 새로운 데이터의 유입/변경/삭제 등을 차단할 수 있어서 데이터 무결성등의 이슈에서 자유로움
 - 이 MongoDB에서 제공하는 Clone Database기능을 활용하면 local 서버에 위치한 데이터가 아닌 remote 상의 데이터도 똑같은 데이터베이스 구조로 복제가 가능
 - 물론 local에서 복사하는 것도 가능한데 이때는 copydatabase 명령어를 사용함
 - 이렇게 복제, 또는 복구 등의 원하는 작업이 끝나면 FSyncLock을 unlock하여야 다시 데이터 입력/수정/삭제가 가능

 **MongoDump, MongoRestore**
 - 가장 흔하게 사용하는 백업 방법
 - MongoDB내의 데이터를 컬렉션, 데이터베이스, 전체 데이터 단위로 백업이 가능
 - 백업되는 데이터는 BSON형태로 저장되어 문자열 형태로 저장된 데이터보다 더 빠르게 백업과 복구가 가능
 - 백업된 데이터는 MongoRestore명령어를 통해 복구 가능
 - MongoDump, MongoRestore와의 차이점은 백업시 데이터 형태를 json, csv,tsv 형태로 백업 가능
 - 아무래도 BSON형태로 백업한 것 보다 속도면에서 느릴 수밖에 없음
 - 별도로 이런툴이 존재하는 이유는 확정성을 담보하기 위해서
 - 이렇게 백업된 데이터는 MongoImport명령어로 복구가능

 ![스크린샷 2017-04-07 오후 12.55.48](http://i.imgur.com/cQpan5f.png)

 ![스크린샷 2017-04-07 오후 12.57.01](http://i.imgur.com/gPDLr1p.png)

 **SnapShot 백업**
 ![스크린샷 2017-04-07 오후 12.59.06](http://i.imgur.com/s87GStR.png)

2. MongoDB데이터베이스 백업/복구 방법에 대해 알 수 있습니다.

![스크린샷 2017-04-07 오후 1.00.51](http://i.imgur.com/lmyuKRl.png)

![스크린샷 2017-04-07 오후 1.01.39](http://i.imgur.com/Yluz7Jm.png)
 반드시 문자열로 저장할 것!!

 ![스크린샷 2017-04-07 오후 1.03.03](http://i.imgur.com/ewFvFoQ.png)

![스크린샷 2017-04-07 오후 1.04.55](http://i.imgur.com/IZMjYC0.png)

![스크린샷 2017-04-07 오후 1.05.54](http://i.imgur.com/q6dln1A.png)

![스크린샷 2017-04-07 오후 1.06.58](http://i.imgur.com/Ies35I5.png)
